# iHRM人力资源 - 主页权限认证、主页内容展示

> [2.IHRM人力资源 - 登录-CSDN博客](https://blog.csdn.net/weixin_51351637/article/details/135596467?spm=1001.2014.3001.5502)

[TOC]

# 一、主页权限认证

## 1.1 主页权限认证分析

**主页权限认证其实就是验证有没有token**

> token所在位置

![image-20240115190158125](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115190158125.png)

**访问主页时**

* **有token**

  放过请求，可以跳转到主页

* **无token**

  拦截访问主页的请求并跳转到登录页让用户进行登录

**访问登录页时**

* **有token**

  直接跳转到主页

* **无token**

  正常访问登录页面

我们可以看一下下面permission.js代码

![image-20240115190355269](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115190355269.png)

将代码收起来看很简洁，一个前置路由守卫beforeEach，一个后置路由守卫router.afterEach

> [Vue - 路由守卫](https://blog.csdn.net/weixin_51351637/article/details/126995759)

![image-20240115190439134](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115190439134.png)

然后再main.js文件中将路由守卫配置引入

![image-20240115190625980](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115190625980.png)



## 1.2 主页权限认证

**主页权限验证就参考下图来就可以**

![image-20240115191124459](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115191124459.png)

### 1.2.1 进度条部分

如下所示是一个进度条的插件，要想使用这个插件，直接引入到我们package.json文件中即可

![image-20240115212452236](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115212452236.png)

进度条的效果如下所示

![image-20240115212853073](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240115212853073.png)

```javascript
// 导入路由实例
import router from '@/router'
// 引入进度条
import nprogress from 'nprogress'
// 引入进度条对应的样式
import 'nprogress/nprogress.css'
// 引入vuex实例对象
import store from '@/store'

/**
 * 前置守卫
 * 参数：
 *  to：信息要到哪里去
 *  from：信息从哪里来
 *  next：必须要执行的函数。如果不执行next，跳转就不会执行。说白了就是让着通行，如果没有next的话，页面会直接空白
 */
router.beforeEach((to, from, next) => {
  // 前置守卫开启进度条
  nprogress.start()
  next()
})

/**
 * 后置守卫
 */
router.afterEach(() => {
  // 关闭进度条 
  nprogress.done()
})
```





### 1.2.2 token 认证

```java
// 导入路由实例
import router from '@/router'
// 引入进度条
import nprogress from 'nprogress'
// 引入进度条对应的样式
import 'nprogress/nprogress.css'
// 引入vuex实例对象
import store from '@/store'

// 定义白名单，此路径不需要token就可以访问
const whiteList = ['/login', '/404']
/**
 * 前置守卫
 * 参数：
 *  to：信息要到哪里去
 *  from：信息从哪里来
 *  next：必须要执行的函数。如果不执行next，跳转就不会执行。说白了就是让着通行，如果没有next的话，页面会直接空白
 */
router.beforeEach((to, from, next) => {
  // 前置守卫开启进度条
  nprogress.start()
  if (store.getters.token) {
    // 存在token
    // 判断要去的地方是不是登录页面
    if (to.path === '/login') {
      // 此时已经登录了，那就直接跳转到主页而不是登录页
      // next("/") 表示中转页面到主页
      next('/')
      // 当next(地址)时并没有执行后置路由守卫，所以说也不会再后置守卫中关闭进度条了
      nprogress.done()
    } else {
      // 说明访问的不是登录页，直接放过就好了
      next()
    }
  } else {
    //   没有token
    // 首先先验证白名单中是否包含路径to.path 使用whiteList.indexOf(to.path) > -1判断也可以
    if (whiteList.includes(to.path)) {
      // 直接放行
      next()
    } else {
      // 中转到登录页
      next('/login')
      // 手动关闭进度条
      nprogress.done()
    }
  }
})

/**
 * 后置守卫
 */
router.afterEach(() => {
  nprogress.done()
})

```



